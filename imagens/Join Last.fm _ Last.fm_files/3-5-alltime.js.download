define(["jquery","core/ajax","kerve/helpers/windowscroll","kerve/helpers/windowsize","kerve/helpers/helper"],function(l,t,r,n,s){function a(l,t){this.el=l}a.prototype.start=function(){c.logs=1==s.config.logs||1==c.dev,c.logs&&console.log("%c*** WIDGET - 3.5 ALL TIME SCROBBLES - START ***","color:#098c0c;"),c.el=this.el,c.locale=c.el.attr("data-locale")||"",c.locale_plays=c.el.attr("data-locale-plays")||"",c.locale_play=c.el.attr("data-locale-play")||"",c.has_transform=s.has_transform(),c.alltimewrap=c.el.find(".alltimewrap"),c.alltime_cols=c.el.find(".alltime_count.rolling"),c.label_scroll=c.el.find(".label_scroll"),c.label_span=c.el.find(".label_span"),c.result=c.el.find(".alltime_result"),c.scrobbles=c.el.find(".alltime_scrobbles"),c.genre=c.el.find(".alltime_genre"),c.intervals=c.data_interval/c.animation_interval;var l="",t=2;for(i=0;i<12;i++){for(3==++t&&(t=0)!=i&&(l+='<div class="alltime_comma">,</div>'),l+='<div class="rolling_col" id="rolling_col'+i+'">',j=0;j<10;j++)l+='<div class="rolling_no">'+j+"</div>";for(j=0;j<10;j++)l+='<div class="rolling_no">'+j+"</div>";l+="</div>"}for(c.alltime_cols.html(l),i=0;i<=11;i++)c["col"+i]=c.el.find("#rolling_col"+i);d(),c.int_get_data=setInterval(function(){d()},c.data_interval);var a=c.alltimewrap.offset().top,e=a+c.alltimewrap.height()/2,o=a+c.alltimewrap.height();r.add("alltime",e,function(){},a,o,function(){c.paused=!0},function(){c.paused=!1}),n.add("alltime",{x_func:function(){var l=c.alltimewrap.offset().top,t=l+c.alltimewrap.height()/2,a=l+c.alltimewrap.height();r.update_pos("alltime",t,l,a),s.label_scroll(c.label_scroll,c.label_span,!1)}})};var c={dev:!(a.prototype.stop=function(){c.logs&&console.log("%c*** WIDGET - 3.5 ALL TIME SCROBBLES - STOP ***","color:#098c0c;"),clearTimeout(c.timeout_init),clearInterval(c.int_get_data),clearInterval(c.int_animate),clearInterval(c.int_animate_tracks),_=[],r.reset(),n.reset()}),dev_data:!1,query_url:"https://kerve.last.fm/kerve/scrobblecount",data_interval:1e4,track_interval:5e3,animation_interval:2e3,animation_time:800,initial_step:768,col_h:100,chars:12,got_data:!1,paused:!1,has_transform:!1,intervals:0,dif:0,step:0,track:null,total:96654507258,total2:0,class:0,timeout_init:null,int_get_data:null,int_animate:null,int_animate_tracks:null},_=[];function d(){var l;1==c.dev_data||1==s.config.dev?(l=s.dev["3-5-alltime"](c.total),c.track=l,f(),c.total=l.global_scrobbles,o(),0==c.got_data&&(c.got_data=!0,c.timeout_init=setTimeout(function(){m()},1e3))):t.get(c.query_url,null,{format:"json"},function(l,t,a,e){c.logs&&console.log("--- ajax response - 3.5 all time scrobbles ---"),c.logs&&console.log(t),void 0!==t.global_scrobbles&&(c.track=t,f(),c.total=t.global_scrobbles,o(),0==c.got_data)&&(c.got_data=!0,c.timeout_init=setTimeout(function(){m()},1e3))})}function o(){0==c.total2?(c.dif=c.initial_step*c.intervals,c.step=c.initial_step):(c.dif=Math.abs(c.total-c.total2),c.step=c.dif/c.intervals),c.total2=c.total-c.dif}function m(){c.int_animate=setInterval(function(){c.total2=Math.ceil(c.total2+c.step);var l=c.total2;if(1!=c.paused){var t,a,e,l=l.toString(),o=l.split(""),l=l.length,r=c.chars-l,i=(c.class=0==c.class?1:0,!1);for(t in o)1!=i&&o[t]==_[t]||(void 0===_[t]?(a=0,e=o[t]*c.col_h):_[t]>=o[t]?(a=_[t]*c.col_h,e=(parseInt(o[t])+10)*c.col_h):(a=_[t]*c.col_h,e=o[t]*c.col_h),function(l,t,a,e){c.has_transform?(c["col"+l].removeClass("red0 red1").css({"-webkit-transform":"translate(0,-"+t+"%)","-moz-transform":"translate(0,-"+t+"%)","-ms-transform":"translate(0,-"+t+"%)",transform:"translate(0,-"+t+"%)"}),setTimeout(function(){c["col"+l].css({"-webkit-transform":"translate(0,-"+a+"%)","-moz-transform":"translate(0,-"+a+"%)","-ms-transform":"translate(0,-"+a+"%)",transform:"translate(0,-"+a+"%)"}).addClass("done red"+e)},100)):c["col"+l].removeClass("red0 red1").css({top:"-"+t+"%"}).animate({top:"-"+a+"%"},c.animation_time).addClass("done red"+e)}(parseInt(t)+r,a,e,c.class),_[t]=o[t],i=!0)}},c.animation_interval)}function f(){var l=c.track.artist,t=c.track.artist_url,a=c.track.track,e=c.track.track_url,o=c.track.tag,r=c.track.tag_url,i=c.track.scrobbles,n=c.track.playlink;c.result.html(s.track(l,t,a,e,c.locale)+s.play(c.locale_play,n)).show(),c.scrobbles.text(c.locale_plays+": "+s.commas(i)).show(),void 0!==o&&""!=o?void 0!==r&&""!=r?c.genre.html('<a href="'+s.url(r,c.locale)+'">'+o+"</a>"):c.genre.html(o):c.genre.html("..."),s.label_scroll(c.label_scroll,c.label_span,!1)}return a});