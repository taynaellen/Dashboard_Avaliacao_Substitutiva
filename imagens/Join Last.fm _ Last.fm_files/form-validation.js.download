define(["require","jquery","core/ajax","components/live-validate-form-field","components/field-messages"],function(t){"use strict";function i(t,e,i){this.name=t,this.$fields=e,this.endpoint=i}function e(t){this.$el=t,this.endpoint=t.data("validation-endpoint"),this.templates={success:this.$el.find(".js-field-success-template").text(),error:this.$el.find(".js-field-errors-template").text(),validating:this.$el.find(".js-field-validating-template").text()}}var n=t("jquery"),s=t("core/ajax"),o=t("components/live-validate-form-field"),a=t("components/field-messages");i.prototype.validate=function(t,e){var i=this.$fields.serialize();this.request&&this.request.abort(),this.request=s.post(this.endpoint,null,i,this.responseHandler.bind(this,e))},i.prototype.responseHandler=function(t,e,i){t(e,i&&i[this.name])},i.prototype.cancel=function(){this.request&&this.request.abort()};return e.prototype.VALIDATION_DELAY=2e3,e.prototype.start=function(){this.createFields(),this.bindEvents()},e.prototype.stop=function(){this.$el.off(".form-validation"),n.each(this.fields,function(){this.stop()})},e.prototype.createFields=function(){this.fields={},this.$el.find("input[name]").each(function(t,e){var e=n(e),i=e.attr("name");this.fields[i]=this.createField(e)}.bind(this))},e.prototype.createField=function(t){var e=new a(t,this.templates);return new o(t,e,new i(t.attr("name"),this.$el,this.endpoint),this.VALIDATION_DELAY)},e.prototype.bindEvents=function(){this.$el.on("focusin.form-validation",this.fieldHandler.bind(this,"focusHandler")),this.$el.on("focusout.form-validation",this.fieldHandler.bind(this,"blurHandler")),this.$el.on("change.form-validation",this.fieldHandler.bind(this,"changeHandler")),this.$el.on(["keyup.form-validation","contextmenu.form-validation","input.form-validation"].join(" "),this.fieldHandler.bind(this,"inputHandler"))},e.prototype.fieldHandler=function(t,e){e=n(e.target).attr("name"),e=this.fields[e];e&&e[t]()},e});