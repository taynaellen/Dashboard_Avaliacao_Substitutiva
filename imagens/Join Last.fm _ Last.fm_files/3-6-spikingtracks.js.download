define(["jquery","core/ajax","kerve/helpers/windowscroll","kerve/helpers/windowsize","kerve/helpers/helper","kerve/plugins/jquery.easing.1.3.min"],function(i,t,a,l,r,e){i.fx.interval=22;function n(e,t){this.el=e}n.prototype.start=function(){o.logs=1==r.config.logs||1==o.dev,o.logs&&console.log("%c*** WIDGET - 3.6 SPIKING TRACKS - START ***","color:#098c0c;"),o.el=this.el,o.locale=o.el.attr("data-locale")||"",o.locale_play=o.el.attr("data-locale-play")||"",o.wrap=o.el.find(".genretodaywrap"),1==o.dev_data||1==r.config.dev?(s=r.dev["3-6-spikingtracks"],c()):t.get(o.query_url,null,{type:"track",nr:o.query_limit,format:"json"},function(e,t,a,i){o.logs&&console.log("--- ajax response - 3.6 spiking tracks ---"),o.logs&&console.log(t.results),void 0!==t.results.track&&(s=t.results.track,c())});var e=o.wrap.offset().top+o.wrap.height()/2;a.add("spikingtracks",e,function(){!function e(){1==o.got_data?o.timeout_init=setTimeout(function(){for(var e in o.min_val=0,o.max_val=0,s)(0==o.min_val||s[e].weight<o.min_val)&&(o.min_val=s[e].weight),(0==o.max_val||s[e].weight>o.max_val)&&(o.max_val=s[e].weight);for(var e in o.step=(o.max_val-o.min_val)/(o.max_w-o.min_w),s)d(e,s[e].weight);o.timeout_scroll=setTimeout(function(){m()},o.scroll_delay),o.int_refresh=setInterval(function(){_()},o.t_refresh)},1e3):o.timeout_retry=setTimeout(function(){e()},50)}()}),l.add("spikingtracks",{x_func:function(){var e;0==a.done("spikingtracks")&&(e=o.wrap.offset().top+o.wrap.height()/2,a.update_pos("spikingtracks",e))}})};var o={dev:!(n.prototype.stop=function(){o.logs&&console.log("%c*** WIDGET - 3.6 SPIKING TRACKS NOW - STOP ***","color:#098c0c;"),clearInterval(o.int_scroll),clearInterval(o.int_refresh),clearTimeout(o.timeout_retry),clearTimeout(o.timeout_init),clearTimeout(o.timeout_animate),clearTimeout(o.timeout_scroll),s={},a.reset(),l.reset()}),dev_data:!1,query_url:"https://kerve.last.fm/kerve/charts",query_limit:5,time_animate:600,time_delay:120,min_w:40,max_w:100,scroll_delay:3e3,scroll_time:3e3,scroll_interval:1e4,t_refresh:15e3,got_data:!1,min_val:0,max_val:0,step:0,scrolling:[],scroll_w:0,int_scroll:null,int_refresh:null,timeout_retry:null,timeout_init:null,timeout_animate:null,timeout_scroll:null},s={};function c(){var e="";if(1==o.got_data){for(var t in o.min_val=0,o.max_val=0,s)(0==o.min_val||s[t].weight<o.min_val)&&(o.min_val=s[t].weight),(0==o.max_val||s[t].weight>o.max_val)&&(o.max_val=s[t].weight);o.step=(o.max_val-o.min_val)/(o.max_w-o.min_w)}for(t in s)var a=(s[t].weight-o.min_val)/o.step+o.min_w,a=1==o.got_data?"width:"+a+"%;":"",e=(e=(e=(e=(e=(e=(e=(e=(e+='<div class="genretodayitem genretodayitem'+t+'" id="genretodayitem'+t+'">')+('<div class="genretoday_img" '+(""!=s[t].image?'style="background-image:url('+s[t].image+');"':"")+">"))+('<div class="genretoday_count">'+(parseInt(t)+1)+"</div>"))+"</div>"+'<div class="genretodaybar_wrap">')+('<div class="genretodaybar" style="'+a+'">')+'<div class="genretodaybar_scroll">')+('<div class="genretoday_track"><span><a href="'+r.url(s[t].url,o.locale)+'">'+s[t].name+"</a></span></div>"))+('<div class="genretoday_artist"><span><a href="'+r.url(s[t].artist_url,o.locale)+'">'+s[t].artist+"</a>"+r.play(o.locale_play,s[t].playlink)+"</span></div>"))+"</div>"+"</div>")+"</div>"+"</div>";o.wrap.html(e),1==o.got_data&&(o.timeout_scroll=setTimeout(function(){m()},o.scroll_delay)),o.got_data=!0}function _(){1==o.dev_data||1==r.config.dev?(s=r.dev["3-6-spikingtracks"],c()):t.get(o.query_url,null,{type:"track",nr:o.query_limit,format:"json"},function(e,t,a,i){o.logs&&console.log("--- ajax response - 3.6 spiking tracks ---"),o.logs&&console.log(t.results),void 0!==t.results.track&&(s=t.results.track,c())})}function d(e,t){var a=(t-o.min_val)/o.step+o.min_w;o.timeout_animate=setTimeout(function(){o.el.find("#genretodayitem"+e+" .genretodaybar").animate({width:a+"%"},o.time_animate,"easeOutBack")},e*o.time_delay)}function m(){o.scrolling=[],o.bars=o.el.find(".genretodaybar"),o.bars.each(function(){var e=i(this).width(),t=i(this).find(".genretoday_artist span").width(),a=i(this).find(".genretoday_track span").width();(e<t||e<a)&&o.scrolling.push(i(this)),t>o.scroll_w&&(o.scroll_w=t),a>o.scroll_w&&(o.scroll_w=a)}),u(),o.int_scroll=setInterval(function(){u()},1e4)}function u(){for(var e in o.scrolling)o.scrolling[e].find(".genretodaybar_scroll").addClass("animate2")}return n});